<!doctype html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Koperasi Web â€” Kasir &amp; Pembukuan</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸª</text></svg>" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay hidden">
      <div class="spinner"></div>
      <p>Memuat dataâ€¦</p>
    </div>

    <div class="container">
      <!-- HEADER -->
      <header class="header">
        <div class="logo">
          <span class="logo-icon">ğŸª</span>
          <div>
            <h1>Koperasi Web</h1>
            <p>Kasir &amp; pembukuan barang berbasis Google Spreadsheet</p>
          </div>
        </div>
      </header>

      <!-- ====== LOGIN ====== -->
      <section id="loginView" class="card login-card">
        <div class="login-icon">ğŸ”</div>
        <h2>Login Admin</h2>
        <form id="loginForm" autocomplete="on">
          <label>
            <span class="label-text">ğŸ‘¤ Username</span>
            <input id="username" type="text" placeholder="Masukkan username" autocomplete="username" required />
          </label>
          <label>
            <span class="label-text">ğŸ”‘ Password</span>
            <div class="password-wrap">
              <input id="password" type="password" placeholder="Masukkan password" autocomplete="current-password" required />
              <button type="button" id="togglePwBtn" class="icon-btn" title="Tampilkan password">ğŸ‘ï¸</button>
            </div>
          </label>
          <button type="submit" id="loginBtn" class="btn-primary btn-full">Masuk</button>
        </form>
        <p id="loginError" class="error"></p>
      </section>

      <!-- ====== APP ====== -->
      <section id="appView" class="hidden">
        <!-- Toolbar -->
        <nav class="toolbar glass-card">
          <div class="toolbar-left">
            <span id="adminBadge" class="admin-badge">ğŸ‘¤ Admin</span>
            <span id="clockDisplay" class="clock-display"></span>
          </div>
          <div class="toolbar-right">
            <button class="btn-tab active" data-tab="kasir">ğŸ’³ Kasir</button>
            <button class="btn-tab" data-tab="barang">ğŸ“¦ Barang</button>
            <button id="refreshBtn" class="btn-icon" title="Refresh data">ğŸ”„</button>
            <button id="logoutBtn" class="btn-logout" title="Logout">ğŸšª Keluar</button>
          </div>
        </nav>

        <!-- ====== TAB: KASIR ====== -->
        <section id="kasirTab" class="tab-panel">
          <div class="kasir-layout">
            <!-- LEFT: Order Builder -->
            <div class="kasir-left">
              <div class="kasir-header glass-card">
                <h2>ğŸ’³ Kasir</h2>
                <div class="kasir-info">
                  <label class="inline-label">
                    <span>ğŸ‘¤</span>
                    <input id="memberName" type="text" placeholder="Nama anggota (opsional)" class="input-flat" />
                  </label>
                  <label class="inline-label">
                    <span>ğŸ’°</span>
                    <select id="paymentMethod" class="input-flat">
                      <option value="cash">ğŸ’µ Cash</option>
                      <option value="transfer">ğŸ¦ Transfer</option>
                      <option value="qris">ğŸ“± QRIS</option>
                    </select>
                  </label>
                </div>
              </div>

              <!-- Quick Product Search -->
              <div class="product-picker glass-card">
                <div class="picker-header">
                  <h3>ğŸ“¦ Pilih Barang</h3>
                  <input id="kasirProductSearch" type="search" placeholder="ğŸ” Cari barang..." class="search-input" />
                </div>
                <div id="productGrid" class="product-grid">
                  <!-- Product cards generated by JS -->
                </div>
              </div>
            </div>

            <!-- RIGHT: Cart / Receipt -->
            <div class="kasir-right">
              <div class="cart-panel glass-card">
                <div class="cart-header">
                  <h3>ğŸ›’ Keranjang</h3>
                  <button id="clearCartBtn" type="button" class="btn-ghost btn-sm">ğŸ—‘ï¸ Kosongkan</button>
                </div>
                <div id="cartItems" class="cart-items">
                  <div class="cart-empty">
                    <span class="cart-empty-icon">ğŸ›’</span>
                    <p>Keranjang kosong</p>
                    <small>Klik barang di sebelah kiri untuk menambahkan</small>
                  </div>
                </div>
                <div class="cart-footer">
                  <div class="cart-total">
                    <span>Total</span>
                    <strong id="cartTotal">Rp 0</strong>
                  </div>
                  <button id="saveTxBtn" type="button" class="btn-checkout">
                    <span class="checkout-icon">âœ…</span>
                    <span>Bayar Sekarang</span>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Transaction History -->
          <div class="glass-card" style="margin-top:20px">
            <div class="section-header">
              <h3>ğŸ“ Riwayat Transaksi</h3>
            </div>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Waktu</th>
                    <th>Kasir</th>
                    <th>Anggota</th>
                    <th>Metode</th>
                    <th>Total</th>
                  </tr>
                </thead>
                <tbody id="txHistoryBody"></tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- ====== TAB: PEMBUKUAN ====== -->
        <section id="barangTab" class="tab-panel hidden">
          <!-- StatsRow -->
          <div class="stats-row" id="statsRow">
            <div class="stat-card stat-blue">
              <div class="stat-icon">ğŸ“¦</div>
              <div class="stat-info">
                <span class="stat-value" id="statTotal">0</span>
                <span class="stat-label">Total Produk</span>
              </div>
            </div>
            <div class="stat-card stat-orange">
              <div class="stat-icon">âš ï¸</div>
              <div class="stat-info">
                <span class="stat-value" id="statLow">0</span>
                <span class="stat-label">Stok Rendah</span>
              </div>
            </div>
            <div class="stat-card stat-red">
              <div class="stat-icon">ğŸš«</div>
              <div class="stat-info">
                <span class="stat-value" id="statEmpty">0</span>
                <span class="stat-label">Stok Habis</span>
              </div>
            </div>
            <div class="stat-card stat-green">
              <div class="stat-icon">ğŸ’°</div>
              <div class="stat-info">
                <span class="stat-value" id="statValue">Rp 0</span>
                <span class="stat-label">Nilai Stok</span>
              </div>
            </div>
          </div>

          <!-- Input Barang (Simplified) -->
          <div class="glass-card">
            <h3>â• Tambah / Update Barang</h3>
            <p class="hint-text">ID akan digenerate otomatis. Cukup isi nama, harga, dan stok.</p>
            <form id="productForm" class="product-form">
              <div class="form-row">
                <label class="form-field flex-2">
                  <span class="label-text">ğŸ“ Nama Barang</span>
                  <input id="productName" type="text" placeholder="mis. Buku Tulis, Pulpen" required />
                </label>
                <label class="form-field flex-1">
                  <span class="label-text">ğŸ’µ Harga Jual</span>
                  <input id="sellPrice" type="number" min="0" step="100" placeholder="5000" required />
                </label>
                <label class="form-field flex-1">
                  <span class="label-text">ğŸ’° Harga Beli</span>
                  <input id="buyPrice" type="number" min="0" step="100" placeholder="3000" required />
                </label>
              </div>
              <div class="form-row">
                <label class="form-field flex-1">
                  <span class="label-text">ğŸ“¦ Stok Awal</span>
                  <input id="stock" type="number" min="0" step="1" placeholder="100" required />
                </label>
                <label class="form-field flex-1">
                  <span class="label-text">âš ï¸ Minimum Stok</span>
                  <input id="minStock" type="number" min="0" step="1" placeholder="10" required />
                </label>
                <div class="form-field flex-1 form-actions">
                  <button type="submit" class="btn-primary btn-full">âœ… Simpan Barang</button>
                </div>
              </div>
            </form>
          </div>

          <!-- Stock Adjustment -->
          <div class="glass-card">
            <h3>ğŸ”„ Penyesuaian Stok</h3>
            <form id="adjustmentForm" class="product-form">
              <div class="form-row">
                <label class="form-field flex-2">
                  <span class="label-text">ğŸ“¦ Barang</span>
                  <select id="adjustProductId" required></select>
                </label>
                <label class="form-field flex-1">
                  <span class="label-text">ğŸ”„ Tipe</span>
                  <select id="adjustType" required>
                    <option value="IN">â• Masuk</option>
                    <option value="OUT">â– Keluar</option>
                  </select>
                </label>
                <label class="form-field flex-half">
                  <span class="label-text">ğŸ”¢ Jumlah</span>
                  <input id="adjustQty" type="number" min="1" step="1" placeholder="0" required />
                </label>
                <label class="form-field flex-1">
                  <span class="label-text">ğŸ“ Catatan</span>
                  <input id="adjustNote" type="text" placeholder="Keterangan" />
                </label>
                <div class="form-field form-actions">
                  <button type="submit" class="btn-primary">âœ… Simpan</button>
                </div>
              </div>
            </form>
          </div>

          <!-- Daftar Barang -->
          <div class="glass-card">
            <div class="section-header">
              <h3>ğŸ“‹ Daftar Barang</h3>
              <input id="productSearch" type="search" placeholder="ğŸ” Cari barangâ€¦" class="search-input" />
            </div>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>Nama</th>
                    <th>Harga Jual</th>
                    <th>Harga Beli</th>
                    <th>Stok</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody id="productsBody"></tbody>
              </table>
            </div>
          </div>

          <!-- Riwayat Pergerakan -->
          <div class="glass-card">
            <div class="section-header">
              <h3>ğŸ“Š Riwayat Pergerakan Stok</h3>
            </div>
            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>Waktu</th>
                    <th>Barang</th>
                    <th>Tipe</th>
                    <th>Qty</th>
                    <th>Saldo</th>
                    <th>Catatan</th>
                  </tr>
                </thead>
                <tbody id="movementsBody"></tbody>
              </table>
            </div>
          </div>
        </section>
      </section>
    </div>

    <!-- ====== MODALS ====== -->
    <div id="successModal" class="modal-backdrop hidden" role="dialog" aria-modal="true">
      <div class="modal modal-success">
        <div class="modal-icon">âœ…</div>
        <h3>Berhasil!</h3>
        <p id="successMsg"></p>
        <button id="successModalBtn" type="button" class="btn-primary btn-full">OK</button>
      </div>
    </div>
    <div id="errorModal" class="modal-backdrop hidden" role="dialog" aria-modal="true">
      <div class="modal modal-error">
        <div class="modal-icon">âŒ</div>
        <h3>Terjadi Kesalahan</h3>
        <p id="errorMsg"></p>
        <button id="errorModalBtn" type="button" class="btn-danger btn-full">OK</button>
      </div>
    </div>

    <!-- Receipt Modal -->
    <div id="receiptModal" class="modal-backdrop hidden" role="dialog" aria-modal="true">
      <div class="modal modal-receipt">
        <div id="receiptContent" class="receipt-content"></div>
        <button id="receiptModalBtn" type="button" class="btn-primary btn-full" style="margin-top:16px">Tutup</button>
      </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
      <p>&copy; 2026 Koperasi Web &bull; Dibuat dengan â¤ï¸</p>
    </footer>

    <script src="/app.js"></script>
  </body>
</html>
