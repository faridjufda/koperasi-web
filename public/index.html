<!doctype html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Koperasi Web â€” Kasir &amp; Pembukuan</title>
    <link rel="icon" href="/favicon.ico" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay hidden">
      <div class="spinner"></div>
      <p>Memuat dataâ€¦</p>
    </div>

    <div class="container">
      <!-- HEADER -->
      <header class="header">
        <div class="logo">
          <span class="logo-icon">ğŸª</span>
          <div>
            <h1>Koperasi Web</h1>
            <p>Kasir &amp; pembukuan barang berbasis Google Spreadsheet</p>
          </div>
        </div>
      </header>

      <!-- ====== LOGIN ====== -->
      <section id="loginView" class="card login-card">
        <div class="login-icon">ğŸ”</div>
        <h2>Login Admin</h2>
        <form id="loginForm" autocomplete="on">
          <label>
            <span class="label-text">ğŸ‘¤ Username</span>
            <input id="username" type="text" placeholder="Masukkan username" autocomplete="username" required />
          </label>
          <label>
            <span class="label-text">ğŸ”‘ Password</span>
            <div class="password-wrap">
              <input id="password" type="password" placeholder="Masukkan password" autocomplete="current-password" required />
              <button type="button" id="togglePwBtn" class="icon-btn" title="Tampilkan password">ğŸ‘ï¸</button>
            </div>
          </label>
          <button type="submit" id="loginBtn" class="btn-primary btn-full">
            <span>Masuk</span>
          </button>
        </form>
        <p id="loginError" class="error"></p>
      </section>

      <!-- ====== APP ====== -->
      <section id="appView" class="hidden">
        <!-- Toolbar -->
        <nav class="toolbar card">
          <div class="toolbar-left">
            <span id="adminBadge" class="admin-badge">ğŸ‘¤ Admin</span>
          </div>
          <div class="toolbar-right">
            <button class="btn-tab active" data-tab="kasir">ğŸ’³ Kasir</button>
            <button class="btn-tab" data-tab="barang">ğŸ“Š Pembukuan</button>
            <button id="refreshBtn" class="btn-icon" title="Refresh data">ğŸ”„</button>
            <button id="logoutBtn" class="btn-danger" title="Logout">ğŸšª Keluar</button>
          </div>
        </nav>

        <!-- ====== TAB: KASIR ====== -->
        <section id="kasirTab" class="tab-panel card">
          <h2>ğŸ’³ Kasir â€” Buat Transaksi</h2>

          <div class="grid-2">
            <label>
              <span class="label-text">ğŸ‘¤ Nama Anggota (opsional)</span>
              <input id="memberName" type="text" placeholder="Nama pemesan" />
            </label>
            <label>
              <span class="label-text">ğŸ’° Metode Bayar</span>
              <select id="paymentMethod">
                <option value="cash">ğŸ’µ Cash</option>
                <option value="transfer">ğŸ¦ Transfer</option>
                <option value="qris">ğŸ“± QRIS</option>
              </select>
            </label>
          </div>

          <div class="section-header">
            <h3>ğŸ›’ Item Transaksi</h3>
            <button id="addTxItemBtn" type="button" class="btn-secondary btn-sm">+ Tambah Item</button>
          </div>

          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Barang</th>
                  <th>Qty</th>
                  <th>Harga</th>
                  <th>Subtotal</th>
                  <th>Aksi</th>
                </tr>
              </thead>
              <tbody id="txItemsBody"></tbody>
            </table>
          </div>

          <div class="total-bar">
            <strong>Total</strong>
            <strong id="txTotal" class="total-amount">Rp 0</strong>
          </div>

          <button id="saveTxBtn" type="button" class="btn-success btn-full">âœ… Simpan Transaksi</button>

          <div class="section-header" style="margin-top:32px;">
            <h3>ğŸ“ Riwayat Transaksi</h3>
          </div>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Waktu</th>
                  <th>Kasir</th>
                  <th>Anggota</th>
                  <th>Metode</th>
                  <th>Total</th>
                </tr>
              </thead>
              <tbody id="txHistoryBody"></tbody>
            </table>
          </div>
        </section>

        <!-- ====== TAB: PEMBUKUAN ====== -->
        <section id="barangTab" class="tab-panel card hidden">
          <h2>ğŸ“Š Pembukuan Barang</h2>

          <!-- Statistik Ringkas -->
          <div class="stats-row" id="statsRow">
            <div class="stat-card">
              <span class="stat-value" id="statTotal">0</span>
              <span class="stat-label">Total Produk</span>
            </div>
            <div class="stat-card stat-warning">
              <span class="stat-value" id="statLow">0</span>
              <span class="stat-label">Stok Rendah</span>
            </div>
            <div class="stat-card stat-danger">
              <span class="stat-value" id="statEmpty">0</span>
              <span class="stat-label">Stok Habis</span>
            </div>
          </div>

          <h3>ğŸ“¦ Input / Update Barang</h3>
          <form id="productForm" class="grid-3">
            <label>
              <span class="label-text">ğŸ·ï¸ Kode Barang (ID)</span>
              <input id="productId" type="text" placeholder="Kosongkan untuk auto" />
            </label>
            <label>
              <span class="label-text">ğŸ“ Nama Barang</span>
              <input id="productName" type="text" placeholder="Nama item" required />
            </label>
            <label>
              <span class="label-text">ğŸ’µ Harga Jual</span>
              <input id="sellPrice" type="number" min="0" step="1" placeholder="0" required />
            </label>
            <label>
              <span class="label-text">ğŸ’° Harga Beli</span>
              <input id="buyPrice" type="number" min="0" step="1" placeholder="0" required />
            </label>
            <label>
              <span class="label-text">ğŸ“¦ Stok</span>
              <input id="stock" type="number" min="0" step="1" placeholder="0" required />
            </label>
            <label>
              <span class="label-text">âš ï¸ Minimum Stok</span>
              <input id="minStock" type="number" min="0" step="1" placeholder="0" required />
            </label>
            <div class="span-full">
              <button type="submit" class="btn-primary">âœ… Simpan Barang</button>
            </div>
          </form>

          <h3>ğŸ”„ Penyesuaian Stok</h3>
          <form id="adjustmentForm" class="grid-4">
            <label>
              <span class="label-text">ğŸ“¦ Barang</span>
              <select id="adjustProductId" required></select>
            </label>
            <label>
              <span class="label-text">ğŸ”„ Tipe</span>
              <select id="adjustType" required>
                <option value="IN">â• IN (Tambah)</option>
                <option value="OUT">â– OUT (Kurang)</option>
              </select>
            </label>
            <label>
              <span class="label-text">ğŸ”¢ Jumlah</span>
              <input id="adjustQty" type="number" min="1" step="1" placeholder="0" required />
            </label>
            <label>
              <span class="label-text">ğŸ“ Catatan</span>
              <input id="adjustNote" type="text" placeholder="mis. rusak, retur, restok" />
            </label>
            <div class="span-full">
              <button type="submit" class="btn-primary">âœ… Simpan Penyesuaian</button>
            </div>
          </form>

          <div class="section-header">
            <h3>ğŸ“‹ Daftar Barang</h3>
            <input id="productSearch" type="search" placeholder="ğŸ” Cari barangâ€¦" class="search-input" />
          </div>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Nama</th>
                  <th>Harga Jual</th>
                  <th>Harga Beli</th>
                  <th>Stok</th>
                  <th>Min Stok</th>
                </tr>
              </thead>
              <tbody id="productsBody"></tbody>
            </table>
          </div>

          <div class="section-header">
            <h3>ğŸ“Š Riwayat Pergerakan Stok</h3>
          </div>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Waktu</th>
                  <th>Barang</th>
                  <th>Tipe</th>
                  <th>Qty</th>
                  <th>Saldo</th>
                  <th>Catatan</th>
                  <th>Petugas</th>
                </tr>
              </thead>
              <tbody id="movementsBody"></tbody>
            </table>
          </div>
        </section>
      </section>
    </div>

    <!-- ====== MODALS ====== -->
    <div id="successModal" class="modal-backdrop hidden" role="dialog" aria-modal="true">
      <div class="modal modal-success">
        <div class="modal-icon">âœ…</div>
        <h3>Sukses</h3>
        <p id="successMsg"></p>
        <button id="successModalBtn" type="button" class="btn-primary btn-full">OK</button>
      </div>
    </div>

    <div id="errorModal" class="modal-backdrop hidden" role="dialog" aria-modal="true">
      <div class="modal modal-error">
        <div class="modal-icon">âŒ</div>
        <h3>Error</h3>
        <p id="errorMsg"></p>
        <button id="errorModalBtn" type="button" class="btn-danger btn-full">OK</button>
      </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
      <p>&copy; 2026 Koperasi Web &bull; Dibuat dengan â¤ï¸</p>
    </footer>

    <script src="/app.js"></script>
  </body>
</html>
